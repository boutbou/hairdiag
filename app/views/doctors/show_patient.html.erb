
<div class="dashboard-container">
  <div class="row">
    <%= render "shared/sidebar-dashboard"%>
    <div class="col-md-10">
      <div class="row dashboard-infos patients-show">

          <h2>FICHE CLIENT</h2>
          <div class="patients-details">
            <div>
              <h3>Informations pratiques <a data-toggle="collapse" data-target="#info-pratiques">
              <i class="fa fa-minus collapse-icon"aria-hidden="true"></i></a>
              </h3>
              <div class="row collapse in" id="info-pratiques">
                <div class="col-md-4">
                  <%= "Nom: " + @patient.first_name + " " + @patient.last_name %>
                </div>
                <div class="col-md-4">
                  <%= "Email: " + @patient.email %>
                </div>
                <div class="col-md-4">
                  <%= "Sexe: " + @patient.gender %>
                </div>
                <div class="col-md-4">
                <%= "Age: #{@patient.age}" %>
                </div>
                <div class="col-md-4">
                  <%= "Code postal: " + @patient.zip_code %>
                </div>
                <div class="col-md-4">
                  <%= "Ville: " + @patient.city %>
                </div>
                <div class="col-md-4">
                  <%= "Pays: " + @patient.country %>
                </div>
              </div>
            </div>
            <div>
              <h3> Context médical <a data-toggle="collapse" data-target="#context-medical">
              <i class="fa fa-minus collapse-icon"aria-hidden="true"></i></a>
              </h3>
              <div class="row collapse in" id="context-medical">
                <div class="col-md-4">
                    <%= "Début de la perte de cheveux: " + @patient.loss_start_date %>
                </div>
                <div class="col-md-4">
                    <%= "Lié au (à la): " + @patient.relative %>
                </div>
                <div class="col-md-4">
                    <%= "Lave ses cheveux #{@patient.weekly_shampoo} fois par semaine" %>
                </div>
                <div class="col-md-4">
                    <%= "Pellicules: " + @patient.dandruff %>
                </div>
                <div class="col-md-4">
                    <%= "Cheveux gras: " + @patient.greasy_hair %>
                </div>
                <div class="col-md-4">
                    <%= "Cheveux affinés: " + @patient.refined_hair %>
                </div>
                <div class="col-md-4">
                    <%= "Brushing: " + @patient.brushing_hair %>
                </div>
                <div class="col-md-4">
                    <%= "Rasage du cuir chevelu: " + @patient.shaving_hair %>
                </div>
                <div class="col-md-4">
                    <%= "Densité capillaire à l'arriere du cuir chevelu: " + @patient.scalp_density %>
                </div>
                <div class="col-md-4">
                    <%= "Epaisseur: " + @patient.hair_thickness %>
                </div>
                <div class="col-md-4">
                    <%= "Couleur: " + @patient.hair_color %>
                </div>
                <div class="col-md-4">
                    <%= "Type de cheveux: " + @patient.hair_type %>
                </div>
              </div>
            </div>
            <div>
              <h3> Situation capillaire <a data-toggle="collapse" data-target="#situation-capillaire">
              <i class="fa fa-minus collapse-icon"aria-hidden="true"></i></a>
              </h3>
              <div class="row collapse in" id="situation-capillaire">
                <div class="col-md-4">
                    <%= "Vitamines: " + @patient.vitamines %>
                </div>
                <div class="col-md-4">
                  <%= "Finasterides? " + @patient.finasteride %>
                </div>
                <div class="col-md-4">
                  <%= "Stade de la perte: " + @patient.stage %>
                </div>
                <div class="col-md-4">
                  <%= "Resultat du test de traction: " + @patient.traction_test %>
                </div>
                <div class="col-md-4">
                  <%= "Zone de restauration souhaitée: " + @patient.restore_area %>
                </div>
                <div class="col-md-4">
                  <%= "Technique de restauration préférée: " + @patient.technical_preference %>
                </div>
                <div class="col-md-4">
                  <%= "Minoxidil? " + @patient.minoxidil %>
                </div>
                <% if @patient.minoxidil == "oui"  %>
                  <div class="col-md-4">
                  <%= "Doses de Minoxidil: #{@patient.minoxidil_doses}%" %>
                </div>
                <% end %>
                <div class="col-md-4">
                  <%= "Transplantation capillaire? " + @patient.hair_transplant %>
                </div>
                <% if @patient.hair_transplant == "oui" %>
                <div class="col-md-4">
                  <%= "Technique de transplantation: " + @patient.hair_transplant_technic %>
                </div>
                <% end %>
              </div>
            </div>
            <div class="patient-photos">
              <h3> Photos <a data-toggle="collapse" data-target="#patient-pictures">
                    <i class="fa fa-minus collapse-icon"aria-hidden="true"></i></a>
              </h3>
              <div class="row collapse in" id="patient-pictures">
                <% if @patient.photos? %>
                  <% @patient.photos.each do |photo| %>
                  <div class="col-md-4 grow">
                  <%= cl_image_tag photo.path, height: 200, width: 200, crop: :fill %>
                  </div>
                  <% end %>
                <% else %>
                  <p>Le patient n'a pas chargé d'image</p>
                <% end %>
              </div>
            </div>
          </div>

        <h2> RECOMMANDATIONS </h2>
        <div class="doctor-recommandations">

          <div class="messages-templates">
            <button id="message-button1" class="messages-templates-buttons switch-message-content" data-message-index="0" data-diagnostic-type="Prescription">Prescription 1</button>

            <button id="message-button2" class="messages-templates-buttons switch-message-content" data-message-index="1" data-diagnostic-type="Prescription">Prescription 2</button>

            <button id="message-button3" class="messages-templates-buttons switch-message-content" data-message-index="2" data-diagnostic-type="Prescription">Prescription 3</button>
          </div>


          <div class="dignastic-choices">
            <button class="dignastic-choices-buttons switch-message-template"
            data-diagnostic-type="Prescription"><i>1</i><p>Prescription</p></button>

            <button class="dignastic-choices-buttons switch-message-template"
            data-diagnostic-type="rdv" data-message-index="1"><i>2</i><p>Proposition de rendez-vous</p></button>

            <button class="dignastic-choices-buttons switch-message-template"
            data-diagnostic-type="Recommandations" data-message-index="2"><i>3</i><p>Recommandations</p></button>
          </div>


          <div class="recommandation-text-area">
            <%= simple_form_for(@recommendation, url: doctor_create_answer_path(@patient)) do |f| %>
            <%= f.error_notification %>
              <div class="form-inputs">
              <%= f.input :subject, required: false %>
              <%= f.input :content, required: false, as: :text %>
              </div>
              <div class="form-actions">
                <%= f.button :submit, "Envoyer le message", class:"btn-cta" %>
              </div>
            <% end %>
          </div>

        </div>


      </div>

      <div class="hexagon"></div>


      <script>
          $('.collapse-icon').click(function() {
            $(this).toggleClass('fa-minus').toggleClass('fa-plus');
          })

          var messageTypes = {
            "Prescription": [
              {
                button: "Prescription 1",
                subject: "Traitement classique",
                content: "Bonjour <%= @patient.first_name %>,\n \nVous nécessitez du traitement classique qui est:\n -3 comprimés de Faipatonchauve pendant 30 jours.\n\nCordialement, \n\n <%= current_doctor.first_name + " " +current_doctor.last_name%>",
              },
              {
                button: "Prescription 2",
                subject: "Mélange de produits en libre-service",
                content: "Bonjour <%= @patient.first_name %>,\n \nIl existe un traitement particuliers pour ce type de perte de cheveux qui prends en compte plusieurs traitements complémentaires à prendre sur 15 jours:\n- Preparles, 3 fois par jour\n- Engraicheuv 2 fois par jour \n- Soipabart 1 comprimé par matin\n\nCordialement, \n\n <%= current_doctor.first_name + " " +current_doctor.last_name%>",
              },
              {
                button: "Prescription 3",
                subject: "Médicaments trouvables dans certaines pharamcies spécialisées",
                content: "Bonjour <%= @patient.first_name %>,\n \nNe vous inquiétez pas pour votre chute de cheveux il existe un traitement très simple: \n- 5mg de Perpatescheuv 3 fois par jour.\nCependant ce médicament est disponible uniquement dans certaines pharmmacies de votre ville comme celle-ci proche de chez vous : 'Pharmacie des Chartreux'\n\nCordialement, \n\n <%= current_doctor.first_name + " " +current_doctor.last_name%>",
              }
            ],

            "rdv": [
              {
                button: "RDV 1",
                subject: "RDV necessaire",
                content: "Bonjour <%= @patient.first_name %>,\n\nIl est necessaire que vous preniez contact avec un spécialiste de votre entourage (ou moi-même) afin d'effectuer des examens approfondis.\n\nCordialement, \n\n <%= current_doctor.first_name + " " +current_doctor.last_name%> \n\nPS: pour prendre Rendez-vous avec moi, veuillez me contacter par mail: <%= current_doctor.email %>",
              },
              {
                button: "RDV 2",
                subject: "RDV avec un confrère",
                content: "Bonjour <%= @patient.first_name %>,\n\nIl est necessaire que vous preniez contact avec un spécialiste que je connais afin d'effectuer des examens approfondis.\nVoici son Mail: potoreno@gmail.com\n\nCordialement, \n\n <%= current_doctor.first_name + " " +current_doctor.last_name%>",
              },
              {
                button: "RDV 3",
                subject: "RDV avec moi",
                content: "Bonjour <%= @patient.first_name %>,\n\nIl est necessaire que vous preniez un rendez-vous avec moi afin d'effectuer des examens approfondis.\nVoici mon email: <%= current_doctor.email%>\n\nCordialement, \n\n <%= current_doctor.first_name + " " +current_doctor.last_name%>",
              }
            ],

            "Recommandations": [
              {
                button: "Reco 1",
                subject: "Recommendation comportementale",
                content: "Bonjour <%= @patient.first_name %>,\n \nBonne nouvelle, nous avons une recommendation qui ne necessite pas de traitement capillaire pour vous:\n1. Agiter la tete de gauche à droite tout les matins 5 fois.\n2.Utiliser le shampoing Superarnak pour laver vos cheveux\n\nCordialement, \n\n<%= current_doctor.first_name + " " +current_doctor.last_name%>",
              },
              {
                button: "Reco 2",
                subject: "Plus de peur que de mal !",
                content: "Bonjour <%= @patient.first_name %>,\n \nBonne nouvelle, vous ne necessitez aucun traitement capillaire, ni aucun consultation, tout est parfaitement normal au niveau capillaire!\n\nCordialement, \n\n<%= current_doctor.first_name + " " +current_doctor.last_name%>",
              },
              {
                button: "Reco 3",
                subject: "Rien à faire!",
                content: "Bonjour <%= @patient.first_name %>,\n \nJ'espère que Barthez vous plait capillairement parlant car vous allez tendre vers lui.\n\nCourage, \n\n<%= current_doctor.first_name + " " +current_doctor.last_name%>",
              }
            ]
          }

          $('.switch-message-template').click(function() {

            var button = $(this);
            var diagnostic = button.data("diagnostic-type");

            var button1 = messageTypes[diagnostic][0].button;
            var button2 = messageTypes[diagnostic][1].button;
            var button3 = messageTypes[diagnostic][2].button;
            var subject = messageTypes[diagnostic][0].subject;
            var content = messageTypes[diagnostic][0].content;

            $('#message-button1').text(button1);
            $('#message-button2').text(button2);
            $('#message-button3').text(button3);
            $("#message_subject").val(subject);
            $("#message_content").val(content);

            $('.messages-templates-buttons').data("diagnostic-type", diagnostic);
            $('.switch-message-template').removeClass('active');
            $(this).addClass('active');
            $('#message-button1').addClass('active');
          });

          $('.switch-message-content').click(function() {
            var button = $(this);
            var diagnostic = button.data('diagnostic-type');
            var message_index = button.data('message-index')

            var subject = messageTypes[diagnostic][parseInt(message_index)].subject;
            $("#message_subject").val(subject);

            var content = messageTypes[diagnostic][parseInt(message_index)].content;
            $("#message_content").val(content);

            $('.switch-message-content').removeClass('active');
            $(this).addClass('active');

          });

      </script>







